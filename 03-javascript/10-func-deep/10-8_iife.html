<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>즉시 실행 함수 (IIFE)</title>
  </head>
  <body>
    <script>
      // 즉시 실행 함수 표현식 (Immediately Invoked Function Expression, IIFE)
      // 함수를 정의함과 동시에 즉시 호출하는 방법입니다.
      // 주요 목적은 변수 스코프를 격리하여 전역 스코프의 오염을 막는 것입니다.

      // --- 1. 기본 문법 ---
      // 함수를 소괄호로 감싸 그룹화한 뒤, 바로 호출합니다.
      (function () {
        console.log("--- 기본 IIFE ---");
        console.log("이 함수는 정의되자마자 실행됩니다.");
      })();

      // --- 2. 변수 스코프 격리 ---
      // IIFE 내부에서 선언된 변수는 외부에서 접근할 수 없습니다.
      // 이를 통해 전역 변수와의 충돌을 방지할 수 있습니다.

      var globalVar = "전역 변수";

      (function () {
        var globalVar = "IIFE 내부 변수"; // 전역 변수와 이름이 같지만 스코프가 다름
        var privateVar = "이 변수는 밖에서 접근 불가";
        console.log("\n--- 스코프 격리 ---");
        console.log("IIFE 내부에서 접근:", globalVar);
      })();

      console.log("IIFE 외부에서 접근:", globalVar); // 전역 변수에는 영향 없음

      try {
        console.log(privateVar); // 에러 발생: Uncaught ReferenceError: privateVar is not defined
      } catch (e) {
        console.error(e);
      }

      // --- 3. 인자 전달 ---
      // IIFE에 인자를 전달하여 사용할 수 있습니다.
      (function (name) {
        console.log("\n--- 인자 전달 ---");
        console.log(`안녕하세요, ${name}님!`);
      })("홍길동");

      // --- 4. 값 반환 (모듈 패턴) ---
      // IIFE가 값을 반환하게 하여, 공개할 멤버와 비공개할 멤버를 구분하는 모듈 패턴에 활용됩니다.
      const counter = (function () {
        let privateCounter = 0; // 비공개 변수

        function changeBy(val) {
          // 비공개 함수
          privateCounter += val;
        }

        // 외부에 공개할 함수들 (객체로 반환)
        return {
          increment: function () {
            changeBy(1);
          },
          decrement: function () {
            changeBy(-1);
          },
          value: function () {
            return privateCounter;
          },
        };
      })();

      console.log("\n--- 값 반환 (모듈 패턴) ---");
      console.log("현재 값:", counter.value()); // 0
      counter.increment();
      counter.increment();
      console.log("증가 후 값:", counter.value()); // 2
      // console.log(counter.privateCounter); // undefined: 비공개 멤버 접근 불가
    </script>
  </body>
</html>
